function cekStatus(){window.connected&&!window.checking&&(window.checking=!0,$.ajax({url:window.currentServerURL+"/?status",type:"POST",data:{key:window.currentServerPassword},timeout:timeout_value}).done(function(e){e.success?window.processing||$.each(e.gpios,function(e,a){var n=a.gpio-1,r=a.status;if("0"==r?$(".switch-control:eq("+n+")").prop("checked",!1):"1"==r&&$(".switch-control:eq("+n+")").prop("checked",!0),"undefined"==typeof a.name)var i="Saklar "+a.gpio;else var i=a.name;$("#saklarname_"+a.gpio).html(i)}):(console.log("cekStatus: nosuccess"),$("#modal-connectionlost").openModal(),$("#setting-content").show(),window.connected=!1)}).fail(function(e,a,n){"timeout"===a?(console.log("cekStatus: timeout"),gagal("Timeout saat menghubungi server!"),$("#saklar-content, .saklar-list, #jadwal-content, #setting-content-nama").fadeOut("fast")):(console.log("cekStatus: error"),$("#modal-connectionlost").openModal(),$("#setting-content").show()),window.connected=!1}).always(function(){window.checking=!1}))}function listServer(){if(null!==localStorage.getItem(["serverName"])){var e="";$.each(window.serverName,function(a,n){e+=n==window.currentServerName?'<li><a href="#" onclick="changeServer(\''+n+'\')"><i class="fa fa-check-circle green-text"></i>&nbsp; '+n+"</a></li>":'<li><a href="#" onclick="changeServer(\''+n+"')\">"+n+"</a></li>"}),$("#list-server").html(e)}}function changeServer(e){if(window.processing=!0,"undefined"==typeof e)$("#errorDiv").hide(),$("#saklar-content, .saklar-list, #jadwal-content, #setting-content, #setting-content-nama").fadeOut("fast",function(){listServer(),$("#loading, #loadingtext").hide(),0==window.serverName.length?($("#noserver").show(),$("#selectserver").hide()):($("#selectserver").show(),$("#noserver").hide()),window.connected=!1});else{$("#errorDiv, #selectserver").hide(),$("#modal-connectionlost").closeModal(),$("ul.tabs").tabs("select_tab","saklar");var a=window.serverName.indexOf(e);window.currentServerName=window.serverName[a],window.currentServerURL=window.serverURL[a],window.currentServerPassword=window.serverKey[a],$("#saklar-content, .saklar-list, #jadwal-content, #setting-content-nama").fadeOut("fast",function(){$("#saklar-list").replaceWith('<ul id="saklar-list" class="saklar-list collection with-header z-depth-1"></ul>'),$("#jadwalharian").replaceWith('<ul id="jadwalharian" class="collapsible" data-collapsible="accordion"><li class="center-align nojadwal">tidak ada jadwal</li></ul>'),$("#jadwalmingguan").replaceWith('<ul id="jadwalmingguan" class="collapsible" data-collapsible="accordion"><li class="center-align nojadwal">tidak ada jadwal</li></ul>'),$("#jadwalbulanan").replaceWith('<ul id="jadwalbulanan" class="collapsible" data-collapsible="accordion"><li class="center-align nojadwal">tidak ada jadwal</li></ul>')}),$("#loading, #loadingtext").show(),$("#loadingtext").html("Server: "+window.currentServerName),$("#toggle-menu-kiri").sideNav("hide"),localStorage.setItem("saklar_lastserver",window.currentServerName),listServer(),getList(),updateSetting(),setTimer()}}function getList(){$.ajax({url:window.currentServerURL+"/?status",type:"POST",data:{key:window.currentServerPassword},timeout:timeout_value}).done(function(e){if(e.success){var a='<ul id="saklar-list" class="saklar-list collection with-header z-depth-1"><li id="list_servername" class="collection-header indigo darken-1"><h4><i class="fa fa-sitemap"></i>&nbsp; '+window.currentServerName+"</h4></li>",n='<div id="gpiolist"><p>Pilih Saklar:</p><p>',r="";$.each(e.gpios,function(e,i){if("undefined"==typeof i.name)var o="Saklar "+i.gpio;else var o=i.name;a+='<li class="collection-item">  <div>    <span id="saklarname_'+i.gpio+'">'+o+'</span>    <a href="#!" class="secondary-content">      <div class="switch">        <label>          <input type="checkbox" class="switch-control" value="'+i.gpio+'">          <span class="lever"></span>        </label>      </div>    </a>  </div></li>',n+='<input type="checkbox" class="filled-in" id="pilih-'+i.gpio+'" name="gpiolist-cb" value="'+i.gpio+'"/><label for="pilih-'+i.gpio+'">'+i.gpio+"</label>",r+='<div class="input-field">  <input placeholder="SAKLAR '+i.gpio+'" type="text" id="name_'+i.gpio+'" name="names[]" value="'+o+'">  <label class="active" for="name_1">Saklar '+i.gpio+"</label></div>"}),a+="</ul>",n+="</p></div>",window.connected=!0,$("#errorDiv, #selectserver").hide(),$("#saklar-list").replaceWith(a),$("#names").html(r),$("#gpiolist").replaceWith(n),$("#saklar-content, .saklar-list, #jadwal-content, #setting-content, #setting-content-nama").fadeIn("fast"),$("#loadingtext").html("Mengambil jadwal.."),getJadwal()}else gagal(e.message)}).fail(function(e,a,n){"timeout"===a?gagal("Timeout saat menghubungi server!"):gagal(),console.log("error: listSaklar")}).always(function(){$("#hapus_namaserver").html(window.currentServerName),$("#btn_hapusserver").attr("value",window.currentServerName)})}function getJadwal(){$.ajax({url:window.currentServerURL+"/?listjadwal",type:"POST",data:{key:window.currentServerPassword}}).done(function(e){e.success&&(__harian='  <ul id="jadwalharian" class="collapsible" data-collapsible="accordion">',0!=e.harian.length?($.each(e.harian,function(e,a){__harian+="<li>",__harian+='<div class="collapsible-header"><i class="fa fa-clock-o"></i>'+a.judul,__harian+='<div class="secondary-content grey-text darken-2-text">'+a.ringkasan+"</div>",__harian+="</div>",__harian+='<div class="collapsible-body grey lighten-4"><i class="fa fa-terminal"></i>'+a.detail+"</div>",__harian+="</li>"}),__harian+="  </ul>"):__harian='    <li class="center-align nojadwal">tidak ada jadwal</li>',__mingguan='  <ul id="jadwalmingguan" class="collapsible" data-collapsible="accordion">',0!=e.mingguan.length?($.each(e.mingguan,function(e,a){__mingguan+="<li>",__mingguan+='<div class="collapsible-header"><i class="fa fa-clock-o"></i>'+a.judul,__mingguan+='<div class="secondary-content grey-text darken-2-text">'+a.ringkasan+"</div>",__mingguan+="</div>",__mingguan+='<div class="collapsible-body grey lighten-4"><i class="fa fa-terminal"></i>'+a.detail+"</div>",__mingguan+="</li>"}),__mingguan+="  </ul>"):__mingguan='    <li class="center-align nojadwal">tidak ada jadwal</li>',__bulanan='  <ul id="jadwalbulanan" class="collapsible" data-collapsible="accordion">',0!=e.bulanan.length?($.each(e.bulanan,function(e,a){__bulanan+="<li>",__bulanan+='<div class="collapsible-header"><i class="fa fa-clock-o"></i>'+a.judul,__bulanan+='<div class="secondary-content grey-text darken-2-text">'+a.ringkasan+"</div>",__bulanan+="</div>",__bulanan+='<div class="collapsible-body grey lighten-4"><i class="fa fa-terminal"></i>'+a.detail+"</div>",__bulanan+="</li>"}),__bulanan+="  </ul>"):__bulanan='    <li class="center-align nojadwal">tidak ada jadwal</li>',$("#jadwalharian").replaceWith(__harian),$("#jadwalmingguan").replaceWith(__mingguan),$("#jadwalbulanan").replaceWith(__bulanan),$(".list-body").hide(),$(".collapsible").collapsible()),window.connected=!0,window.processing=!1,cekStatus(),setTimer(),$("#loadingtext, #loading").hide(),console.log("saklarku-app siap!")}).fail(function(){$("#loadingtext, #loading").hide(),console.log("error: listJadwal")})}function updateSetting(){$("#setting_servername").val(window.currentServerName),$("#setting_servername_old").val(window.currentServerName),$("#setting_serverurl").val(window.currentServerURL),$("#setting_serverpass").val(window.currentServerPassword)}function setTimer(){clearInterval(window.timer),window.timer=setInterval(function(){window.processing?console.log("cek status: lagi proses"):window.connected?cekStatus():console.log("cek status: ndak konek")},5e3)}function gagal(e){__html='<div class="card red col s12">',__html+='  <div class="card-content white-text">',__html+='    <span class="card-title white-text">Gagal!</span>',__html+="    <p>Gagal menyambungkan ke server <b>"+window.currentServerName+"</b>, pastikan server online dan bisa diakses oleh device. Periksa juga URL dan password servernya.</p>",__html+="    <br><p>ServerURL: "+window.currentServerURL+"</p>",void 0!=e&&(__html+="    <p>error: <b>"+e+"</b></p>"),__html+="  </div>",__html+="</div>",$("#errorDiv").show().html(__html),$("#loadingtext").hide(),$("#loading").hide(),window.connected=!1,$("#setting-content").show()}versi="0.2.0",build="20151117",timeout_value=15e3,$(document).ready(function(){if($(".version").html(versi),$("#buildver").html(build),window.processing=!0,window.connected=!1,window.checking=!1,$("#toggle-menu-kiri").sideNav({closeOnClick:!0}),$(".modal-trigger").leanModal(),"false"!=localStorage.getItem("saklar_firstrun"))console.log("pertama run!"),localStorage.clear(),localStorage.setItem("saklar_firstrun","false"),window.serverName=new Array,localStorage.serverName=JSON.stringify(serverName),window.serverURL=new Array,localStorage.serverURL=JSON.stringify(serverURL),window.serverKey=new Array,localStorage.serverKey=JSON.stringify(serverKey),$("#noserver").fadeIn("400",function(){$("#loading").hide()}),$("#loadingtext").hide();else if(null!==localStorage.getItem(["serverName"])?(window.serverName=JSON.parse(localStorage.serverName),window.serverURL=JSON.parse(localStorage.serverURL),window.serverKey=JSON.parse(localStorage.serverKey)):(window.serverName=new Array,localStorage.serverName=JSON.stringify(serverName),window.serverURL=new Array,localStorage.serverURL=JSON.stringify(serverURL),window.serverKey=new Array,localStorage.serverKey=JSON.stringify(serverKey)),0==window.serverName.length)console.log("server-empty"),$("#noserver").fadeIn("400",function(){$("#loading").hide()}),$("#loadingtext").hide();else if("undefined"==localStorage.getItem("saklar_lastserver"))changeServer();else if("deleted"==localStorage.getItem("saklar_lastserver"))changeServer();else{console.log("server-get-last:",localStorage.getItem("saklar_lastserver"));var e=window.serverName.indexOf(localStorage.getItem("saklar_lastserver"));window.currentServerName=window.serverName[e],window.currentServerURL=window.serverURL[e],window.currentServerPassword=window.serverKey[e],$("#loadingtext").html("Server: "+window.currentServerName),listServer(),getList(),updateSetting(),console.log(window.currentServerName+" siap!")}console.log("ready")}),$(window).load(function(){$(document).on("click",".switch-control",function(e){e.preventDefault(),e.stopPropagation();var a=$(this);if(window.processing)console.log("lagi proses"),e.preventDefault(),e.stopPropagation();else{window.processing=!0;var n=$(this).val();$("#loading").show(),$.ajax({url:window.currentServerURL+"/?toggle",type:"POST",data:{key:window.currentServerPassword,target:n}}).done(function(e){e.success?(a.prop("checked")?a.prop("checked",!1):a.prop("checked",!0),$("#allon, #alloff").attr("checked",!1),window.processing=!1,window.connected=!0,$("#loading").hide(),Materialize.toast(e.message,2e3)):(window.processing=!1,$("#loading").hide(),Materialize.toast("[GAGAL] "+e.message,2e3))}).fail(function(){console.log("error: toggle"),$("#modal-connectionlost").openModal(),$("#setting-content").show(),window.connected=!1,window.processing=!1,$("#loading").hide()})}}),$("#allon").click(function(e){window.processing?console.log("lagi proses"):(window.processing=!0,$("#loading").show(),$.ajax({url:window.currentServerURL+"/?allon",type:"POST",data:{key:window.currentServerPassword}}).done(function(e){e.success?($(".switch-control").prop("checked",!0),window.processing=!1,window.connected=!0,$("#loading").hide(),Materialize.toast("Semua GPIO ON",2e3)):(window.processing=!1,$("#loading").hide(),Materialize.toast("[GAGAL] "+e.message,2e3))}).fail(function(){console.log("error: allOn"),$("#modal-connectionlost").openModal(),$("#setting-content").show(),window.connected=!1,window.processing=!1,$("#loading").hide()}))}),$("#alloff").click(function(e){window.processing?console.log("lagi proses"):(window.processing=!0,$("#loading").show(),$.ajax({url:window.currentServerURL+"/?alloff",type:"POST",data:{key:window.currentServerPassword}}).done(function(e){e.success?($(".switch-control").prop("checked",!1),window.processing=!1,window.connected=!0,$("#loading").hide(),Materialize.toast("Semua GPIO OFF",2e3)):(window.processing=!1,$("#loading").hide(),Materialize.toast("[GAGAL] "+e.message,2e3))}).fail(function(){console.log("error: allOff"),$("#modal-connectionlost").openModal(),$("#setting-content").show(),window.connected=!1,window.processing=!1,$("#loading").hide()}))}),$("#btn_addserver").click(function(){var e=$("#servername").val(),a=$("#serverurl").val(),n=$("#serverpass").val();"/"===a.substr(-1)&&(a=a.substr(0,a.length-1)),window.serverName.indexOf(e)>-1?$("#server-name-error").html("<br>Sudah ada! Gunakan nama lain!"):($("#server-name-error, #server-add-error").html(""),$.ajax({url:a+"/?auth",type:"POST",data:{key:n},timeout:timeout_value}).done(function(r){if(r.success)window.serverName.push(e),window.serverURL.push(a),window.serverKey.push(n),localStorage.serverName=JSON.stringify(serverName),localStorage.serverURL=JSON.stringify(serverURL),localStorage.serverKey=JSON.stringify(serverKey),window.currentServerName=e,window.currentServerURL=a,window.currentServerPassword=n,$("#servername").val(""),$("#serverurl").val(""),$("#serverpass").val(""),$("#noserver").hide(),$("#loadingtext").html("Server: "+window.currentServerName),$("#loading, #loadingtext").show(),$("#modal-tambah-server").closeModal(),localStorage.setItem("saklar_lastserver",window.currentServerName),listServer(),getList(),updateSetting(),setTimer(),$("ul.tabs").tabs("select_tab","saklar");else{console.log("gagal!");var i="<br>"+r.message;$("#server-add-error").html("Gagal menambahkan server!"+i)}}).fail(function(){console.log("fail!"),$("#server-add-error").html("Gagal menambahkan server!")}))}),$(".btn_groupcmd").click(function(){var e=$(this).val(),a="",n="";$('input[name="gpiolist-cb"]:checked').each(function(){n+=this.value,a+=e}),window.processing?console.log("lagi proses"):(window.processing=!0,$("#loading").show(),$.ajax({url:window.currentServerURL+"/?group",type:"POST",data:{key:window.currentServerPassword,target:n,status:a}}).done(function(r){r.success?(window.processing=!1,window.connected=!0,$("#loading").hide(),$.each(r.groups,function(a,n){var r=n.target-1;"0"==e?$(".switch-control:eq("+r+")").prop("checked",!1):$(".switch-control:eq("+r+")").prop("checked",!0)}),Materialize.toast("GPIO "+n+" > "+a,2e3)):(window.processing=!1,$("#loading").hide(),Materialize.toast("[GAGAL] "+r.message,2e3))}).fail(function(){console.log("error: groupcmd"),$("#modal-connectionlost").openModal(),$("#setting-content").show(),window.connected=!1,window.processing=!1,$("#loading").hide()}))}),$("#btn_setting_save").click(function(e){var a=($("#setting_servername_old").val(),$("#setting_servername").val()),n=$("#setting_serverurl").val(),r=$("#setting_serverpass").val(),i=window.serverName.indexOf(window.currentServerName);window.serverName[i]=a,window.serverURL[i]=n,window.serverKey[i]=r,localStorage.serverName=JSON.stringify(window.serverName),localStorage.serverURL=JSON.stringify(window.serverURL),localStorage.serverKey=JSON.stringify(window.serverKey),localStorage.setItem("saklar_lastserver",a),window.currentServerName=a,window.currentServerURL=n,window.currentServerPassword=r,$("#saved").fadeIn(400,function(){$(this).delay(1e3).fadeOut(400),$("#list_servername").html('<h4><i class="fa fa-sitemap"></i>&nbsp; '+a+"</h4>"),$("#hapus_namaserver").html(a),$("#btn_hapusserver").attr("value",a)}),listServer()}),$("#btn_name_save").click(function(e){var a="";$("input[name='names[]']").each(function(){a+=$(this).val().replace(/;/g,"")+";"}),a=a.replace(/;$/,"").replace(/\"/g,"").replace(/\'/g,""),window.processing?console.log("lagi proses"):($("#loading").show(),window.processing=!0,$.ajax({url:window.currentServerURL+"/?updatenama",type:"POST",data:{key:window.currentServerPassword,nama:a},timeout:timeout_value}).done(function(e){e.success?($.each(e.gpios,function(e,a){$("#saklarname_"+a.gpio).html(a.name)}),$("#saved_name").fadeIn(400,function(){$(this).delay(1e3).fadeOut(400)})):"request tidak lengkap atau salah"==e.message&&($("#message-header").html("Update Script Server!"),$("#message-content").html("Tidak bisa menyimpan nama saklar.<br>Update script server dengan versi terbaru di github!"),$("#modal-message").openModal(),console.log("oldversion!"))}).always(function(){$("#loading").hide(),window.processing=!1}))}),$("#btn_hapusserver").click(function(e){var a=window.serverName.indexOf($(this).attr("value"));window.serverName.splice(a,1),window.serverURL.splice(a,1),window.serverKey.splice(a,1),localStorage.serverName=JSON.stringify(window.serverName),localStorage.serverURL=JSON.stringify(window.serverURL),localStorage.serverKey=JSON.stringify(window.serverKey),localStorage.setItem("saklar_lastserver","deleted"),$("#modal-hapus-server").closeModal(),changeServer()}),$("#btn_reload").click(function(){$("#modal-connectionlost").closeModal(),changeServer(window.currentServerName)}),$("#serverurl").focus(function(e){""==$(this).val()&&$(this).val("http://")}),console.log("window loaded")});